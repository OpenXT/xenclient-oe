################################################################################
SHORT DESCRIPTION: 
################################################################################

################################################################################
LONG DESCRIPTION: 
################################################################################

################################################################################
CHANGELOG 
################################################################################

################################################################################
REMOVAL 
################################################################################

################################################################################
UPSTREAM PLAN
################################################################################

################################################################################
INTERNAL DEPENDENCIES 
################################################################################

################################################################################
PATCHES 
################################################################################
Index: xen-4.6.5/xen/common/event_2l.c
===================================================================
--- xen-4.6.5.orig/xen/common/event_2l.c
+++ xen-4.6.5/xen/common/event_2l.c
@@ -19,6 +19,12 @@ static void evtchn_2l_set_pending(struct
     struct domain *d = v->domain;
     unsigned int port = evtchn->port;
 
+    /* if domain is in S3 it will miss the notification, so check here */
+    if (d->arch.hvm_domain.is_s3_suspended) {
+        return;
+    }
+
+
     /*
      * The following bit operations must happen in strict order.
      * NB. On x86, the atomic bit operations also act as memory barriers.
